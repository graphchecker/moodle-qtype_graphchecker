{"version":3,"sources":["../src/graphelements.js"],"names":["define","$","util","PetriNodeType","Object","freeze","NONE","PLACE","TRANSITION","ModeType","EDIT","DRAW","CheckboxType","FSM_INITIAL","FSM_FINAL","Node","parent","x","y","mouseOffsetX","mouseOffsetY","isInitial","isFinal","petriNodeType","text","prototype","setMouseStart","mouseX","mouseY","setAnchorPoint","trackMouse","draw","c","beginPath","arc","nodeRadius","Math","PI","rect","stroke","drawText","closestPointOnCircle","dx","dy","scale","sqrt","containsPoint","neighbours","links","link","i","length","Link","nodeA","includes","nodeB","push","hasStartLink","StartLink","node","traverseGraph","visited","neighbour","a","b","lineAngleAdjust","parallelPart","perpendicularPart","getAnchorPoint","abs","SNAP_TO_PADDING","getEndPointsAndCircle","midX","midY","start","end","anchor","circle","circleFromThreePoints","isReversed","reverseScale","rRatio","radius","startAngle","atan2","endAngle","startX","cos","startY","sin","endX","endY","linkInfo","textX","textY","textAngle","hasCircle","circleX","circleY","circleRadius","moveTo","lineTo","arrowIfReqd","distance","HIT_TARGET_PADDING","angle","temp","percent","calculateAngle","linkPoint","nodeToLinkVector","rightVector","SelfLink","mouse","anchorAngle","mouseOffsetAngle","snap","round","deltaX","deltaY","getEndPoints","endPoints","TemporaryLink","from","to","Button","toolbar","w","h","iconClass","title","width","height","icon","create","id","split","join","toolbarContainerHeight","$button","attr","append","addClass","button","onClick","ModeButton","buttonModeType","call","constructor","setSelected","removeClass","onModeButtonPressed","setDeselected","HelpButton","displayHelpOverlay","Checkbox","type","eventFunction","$checkbox","addEventListener","event","handleInteraction","object","TextField","placeholderText","$textfield"],"mappings":"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","sourcesContent":["/******************************************************************************\n *\n * A module for use by ui_graph, defining classes Node, Link, SelfLink,\n * StartLink and TemporaryLink\n *\n ******************************************************************************/\n// This code is a modified version of Finite State Machine Designer\n// (http://madebyevan.com/fsm/)\n/*\n Finite State Machine Designer (http://madebyevan.com/fsm/)\n License: MIT License (see below)\n Copyright (c) 2010 Evan Wallace\n Permission is hereby granted, free of charge, to any person\n obtaining a copy of this software and associated documentation\n files (the \"Software\"), to deal in the Software without\n restriction, including without limitation the rights to use,\n copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the\n Software is furnished to do so, subject to the following\n conditions:\n The above copyright notice and this permission notice shall be\n included in all copies or substantial portions of the Software.\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n OTHER DEALINGS IN THE SOFTWARE.\n*/\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more util.details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n\ndefine(['jquery', 'qtype_graphchecker/graphutil'], function($, util) {\n\n    // An enum for defining the node types of petri nets\n    const PetriNodeType = Object.freeze({\n        NONE: 'none',               // Indicates not a petri node\n        PLACE: 'place',             // Indicates not a petri place\n        TRANSITION: 'transition'    // Indicates not a petri transition\n    });\n\n    // An enum for defining the mode type of the graph UI\n    const ModeType = Object.freeze({\n        EDIT: 'edit',               // Indicates that the UI is in edit mode\n        DRAW: 'draw'                // Indicates that the UI is in draw mode\n    });\n\n    // An enum for defining the type of the checkboxes graph UI\n    const CheckboxType = Object.freeze({\n        FSM_INITIAL: 'fsm_initial',         // Indicates that the checkbox controls the initial fsm state\n        FSM_FINAL: 'fsm_final'             // Indicates that the checkbox controls the final fsm state\n    });\n\n    /***********************************************************************\n     *\n     * Define a class Node that represents a node in a graph\n     *\n     ***********************************************************************/\n\n    function Node(parent, x, y) {\n        this.parent = parent;  // The ui_graph instance.\n        this.x = x;\n        this.y = y;\n        this.mouseOffsetX = 0;\n        this.mouseOffsetY = 0;\n        this.isInitial = false;\n        this.isFinal = false;\n        // When in Petri mode, this variable denotes whether the node is a place or a transition:\n        this.petriNodeType = PetriNodeType.NONE;\n        this.text = '';\n    }\n\n    // At the start of a drag, record our position relative to the mouse.\n    Node.prototype.setMouseStart = function(mouseX, mouseY) {\n        this.mouseOffsetX = this.x - mouseX;\n        this.mouseOffsetY = this.y - mouseY;\n    };\n\n    Node.prototype.setAnchorPoint = function(x, y) {\n        this.x = x + this.mouseOffsetX;\n        this.y = y + this.mouseOffsetY;\n    };\n\n    // Given a new mouse position during a drag, move to the appropriate\n    // new position.\n    Node.prototype.trackMouse = function(mouseX, mouseY) {\n        this.x = this.mouseOffsetX + mouseX;\n        this.y = this.mouseOffsetY + mouseY;\n    };\n\n    Node.prototype.draw = function(c) {\n        // Draw the circle.\n        c.beginPath();\n        if (this.petriNodeType === PetriNodeType.NONE || this.petriNodeType === PetriNodeType.PLACE) {\n            c.arc(this.x, this.y, this.parent.nodeRadius(), 0, 2 * Math.PI, false);\n        } else if (this.petriNodeType === PetriNodeType.TRANSITION) {\n            c.rect(this.x - this.parent.nodeRadius(), this.y - this.parent.nodeRadius(),\n                this.parent.nodeRadius()*2, this.parent.nodeRadius()*2);\n        }\n        c.stroke();\n\n        // Draw the text.\n        this.parent.drawText(this.text, this.x, this.y, null, this);\n\n        // Draw a double circle for an accept state.\n        if(this.isFinal) {\n            c.beginPath();\n            c.arc(this.x, this.y, this.parent.nodeRadius() - 6, 0, 2 * Math.PI, false);\n            c.stroke();\n        }\n    };\n\n    Node.prototype.closestPointOnCircle = function(x, y) {\n        var dx = x - this.x;\n        var dy = y - this.y;\n        var scale = Math.sqrt(dx * dx + dy * dy);\n        return {\n            'x': this.x + dx * this.parent.nodeRadius() / scale,\n            'y': this.y + dy * this.parent.nodeRadius() / scale,\n        };\n    };\n\n    Node.prototype.containsPoint = function(x, y) {\n        return (x - this.x) * (x - this.x) + (y - this.y) * (y - this.y) < this.parent.nodeRadius() * this.parent.nodeRadius();\n    };\n\n    // Method of a Node that, given a list of all links in a graph, returns\n    // a list of any nodes that contain a link to this node (excluding StartLinks\n    // and SelfLinks).\n    Node.prototype.neighbours = function(links) {\n        var neighbours = [], link;\n        for (var i = 0; i < links.length; i++) {\n            link = links[i];\n            if (link instanceof Link) { // Exclude SelfLinks and StartLinks.\n                if (link.nodeA === this && !neighbours.includes(link.nodeB)) {\n                    neighbours.push(link.nodeB);\n                } else if (link.nodeB === this && !neighbours.includes(link.nodeA)) {\n                    neighbours.push(link.nodeA);\n                }\n            }\n        }\n        return neighbours;\n    };\n\n    // A function returning whether or not the node has any incoming start links\n    Node.prototype.hasStartLink = function(links) {\n        let hasStartLink = false;\n        for (let i = 0; i < links.length; i++) {\n            if (links[i] instanceof StartLink && links[i].node === this) {\n                hasStartLink = true;\n                break;\n            }\n        }\n        return hasStartLink;\n    };\n\n    // Method of Node that traverses a graph defined by a given set of links\n    // starting at 'this' node and updating the visited list for each new\n    // node. Returns the updated visited list, which (for the root call)\n    // is a list of all nodes connected to the given start node.\n    Node.prototype.traverseGraph = function(links, visited) {\n        var neighbours,\n            neighbour;\n        if (!visited.includes(this)) {\n            visited.push(this);\n            neighbours = this.neighbours(links);\n            for (var i = 0; i < neighbours.length; i++) {\n                neighbour = neighbours[i];\n                if (!visited.includes(neighbour)) {\n                    neighbour.traverseGraph(links, visited);\n                }\n            }\n        }\n        return visited;\n    };\n\n    /***********************************************************************\n     *\n     * Define a class Link that represents a connection between two nodes.\n     *\n     ***********************************************************************/\n    function Link(parent, a, b) {\n        this.parent = parent;  // The parent ui_digraph instance.\n        this.nodeA = a;\n        this.nodeB = b;\n        this.text = '';\n        this.lineAngleAdjust = 0; // Value to add to textAngle when link is straight line.\n\n        // Make anchor point relative to the locations of nodeA and nodeB.\n        this.parallelPart = 0.5;    // Percentage from nodeA to nodeB.\n        this.perpendicularPart = 0; // Pixels from line between nodeA and nodeB.\n    }\n\n    Link.prototype.getAnchorPoint = function() {\n        var dx = this.nodeB.x - this.nodeA.x;\n        var dy = this.nodeB.y - this.nodeA.y;\n        var scale = Math.sqrt(dx * dx + dy * dy);\n        return {\n            'x': this.nodeA.x + dx * this.parallelPart - dy * this.perpendicularPart / scale,\n            'y': this.nodeA.y + dy * this.parallelPart + dx * this.perpendicularPart / scale\n        };\n    };\n\n    Link.prototype.setAnchorPoint = function(x, y) {\n        var dx = this.nodeB.x - this.nodeA.x;\n        var dy = this.nodeB.y - this.nodeA.y;\n        var scale = Math.sqrt(dx * dx + dy * dy);\n        this.parallelPart = (dx * (x - this.nodeA.x) + dy * (y - this.nodeA.y)) / (scale * scale);\n        this.perpendicularPart = (dx * (y - this.nodeA.y) - dy * (x - this.nodeA.x)) / scale;\n        // Snap to a straight line.\n        if(this.parallelPart > 0 && this.parallelPart < 1 && Math.abs(this.perpendicularPart) < this.parent.SNAP_TO_PADDING) {\n            this.lineAngleAdjust = (this.perpendicularPart < 0) * Math.PI;\n            this.perpendicularPart = 0;\n        }\n    };\n\n    Link.prototype.getEndPointsAndCircle = function() {\n        if(this.perpendicularPart === 0) {\n            var midX = (this.nodeA.x + this.nodeB.x) / 2;\n            var midY = (this.nodeA.y + this.nodeB.y) / 2;\n            var start = this.nodeA.closestPointOnCircle(midX, midY);\n            var end = this.nodeB.closestPointOnCircle(midX, midY);\n            return {\n                'hasCircle': false,\n                'startX': start.x,\n                'startY': start.y,\n                'endX': end.x,\n                'endY': end.y,\n            };\n        }\n        var anchor = this.getAnchorPoint();\n        var circle = util.circleFromThreePoints(this.nodeA.x, this.nodeA.y, this.nodeB.x, this.nodeB.y, anchor.x, anchor.y);\n        var isReversed = (this.perpendicularPart > 0);\n        var reverseScale = isReversed ? 1 : -1;\n        var rRatio = reverseScale * this.parent.nodeRadius() / circle.radius;\n        var startAngle = Math.atan2(this.nodeA.y - circle.y, this.nodeA.x - circle.x) - rRatio;\n        var endAngle = Math.atan2(this.nodeB.y - circle.y, this.nodeB.x - circle.x) + rRatio;\n        var startX = circle.x + circle.radius * Math.cos(startAngle);\n        var startY = circle.y + circle.radius * Math.sin(startAngle);\n        var endX = circle.x + circle.radius * Math.cos(endAngle);\n        var endY = circle.y + circle.radius * Math.sin(endAngle);\n        return {\n            'hasCircle': true,\n            'startX': startX,\n            'startY': startY,\n            'endX': endX,\n            'endY': endY,\n            'startAngle': startAngle,\n            'endAngle': endAngle,\n            'circleX': circle.x,\n            'circleY': circle.y,\n            'circleRadius': circle.radius,\n            'reverseScale': reverseScale,\n            'isReversed': isReversed,\n        };\n    };\n\n    Link.prototype.draw = function(c) {\n        var linkInfo = this.getEndPointsAndCircle(), textX, textY, textAngle;\n        // Draw arc.\n        c.beginPath();\n        if(linkInfo.hasCircle) {\n            c.arc(linkInfo.circleX,\n                  linkInfo.circleY,\n                  linkInfo.circleRadius,\n                  linkInfo.startAngle,\n                  linkInfo.endAngle,\n                  linkInfo.isReversed);\n        } else {\n            c.moveTo(linkInfo.startX, linkInfo.startY);\n            c.lineTo(linkInfo.endX, linkInfo.endY);\n        }\n        c.stroke();\n        // Draw the head of the arrow.\n        if(linkInfo.hasCircle) {\n            this.parent.arrowIfReqd(c,\n                      linkInfo.endX,\n                      linkInfo.endY,\n                      linkInfo.endAngle - linkInfo.reverseScale * (Math.PI / 2));\n        } else {\n            this.parent.arrowIfReqd(c,\n                      linkInfo.endX,\n                      linkInfo.endY,\n                      Math.atan2(linkInfo.endY - linkInfo.startY, linkInfo.endX - linkInfo.startX));\n        }\n        // Draw the text.\n        if(linkInfo.hasCircle) {\n            var startAngle = linkInfo.startAngle;\n            var endAngle = linkInfo.endAngle;\n            if(endAngle < startAngle) {\n                endAngle += Math.PI * 2;\n            }\n            textAngle = (startAngle + endAngle) / 2 + linkInfo.isReversed * Math.PI;\n            textX = linkInfo.circleX + linkInfo.circleRadius * Math.cos(textAngle);\n            textY = linkInfo.circleY + linkInfo.circleRadius * Math.sin(textAngle);\n            this.parent.drawText(this.text, textX, textY, textAngle, this);\n        } else {\n            textX = (linkInfo.startX + linkInfo.endX) / 2;\n            textY = (linkInfo.startY + linkInfo.endY) / 2;\n            textAngle = Math.atan2(linkInfo.endX - linkInfo.startX, linkInfo.startY - linkInfo.endY);\n            this.parent.drawText(this.text, textX, textY, textAngle + this.lineAngleAdjust, this);\n        }\n    };\n\n    Link.prototype.containsPoint = function(x, y) {\n        var linkInfo = this.getEndPointsAndCircle(), dx, dy, distance;\n        if(linkInfo.hasCircle) {\n            dx = x - linkInfo.circleX;\n            dy = y - linkInfo.circleY;\n            distance = Math.sqrt(dx * dx + dy * dy) - linkInfo.circleRadius;\n            if(Math.abs(distance) < this.parent.HIT_TARGET_PADDING) {\n                var angle = Math.atan2(dy, dx);\n                var startAngle = linkInfo.startAngle;\n                var endAngle = linkInfo.endAngle;\n                if(linkInfo.isReversed) {\n                    var temp = startAngle;\n                    startAngle = endAngle;\n                    endAngle = temp;\n                }\n                if(endAngle < startAngle) {\n                    endAngle += Math.PI * 2;\n                }\n                if(angle < startAngle) {\n                    angle += Math.PI * 2;\n                } else if(angle > endAngle) {\n                    angle -= Math.PI * 2;\n                }\n                return (angle > startAngle && angle < endAngle);\n            }\n        } else {\n            dx = linkInfo.endX - linkInfo.startX;\n            dy = linkInfo.endY - linkInfo.startY;\n            var length = Math.sqrt(dx * dx + dy * dy);\n            var percent = (dx * (x - linkInfo.startX) + dy * (y - linkInfo.startY)) / (length * length);\n            distance = (dx * (y - linkInfo.startY) - dy * (x - linkInfo.startX)) / length;\n            return (percent > 0 && percent < 1 && Math.abs(distance) < this.parent.HIT_TARGET_PADDING);\n        }\n        return false;\n    };\n\n    Link.prototype.calculateAngle = function(node) {\n        // Calculates the angle in radians of the point of the link touching the selected node's circle with\n        // the selected node itself\n        let linkPoint = {};\n        let linkInfo = this.getEndPointsAndCircle();\n\n        if (this.nodeA === node) {\n            // If the link originates in the node\n            linkPoint.x = linkInfo.startX;\n            linkPoint.y = linkInfo.startY;\n        } else if (this.nodeB === node) {\n            // If the link ends in the node\n            linkPoint.x = linkInfo.endX;\n            linkPoint.y = linkInfo.endY;\n        } else {\n            // The link is not connected to the input node\n            return;\n        }\n\n        let nodeToLinkVector = { //TODO: maybe noramlize in length? mb it's not needed\n            x: node.x - linkPoint.x,\n            y: node.y - linkPoint.y\n        };\n        let rightVector = {\n            x: 1,\n            y: 0\n        };\n\n        return (Math.atan2(rightVector.y, rightVector.x) - Math.atan2(nodeToLinkVector.y, nodeToLinkVector.x)\n            + Math.PI) % (2*Math.PI);\n    };\n\n    /***********************************************************************\n     *\n     * Define a class SelfLink that represents a connection from a node back\n     * to itself.\n     *\n     ***********************************************************************/\n\n    function SelfLink(parent, node, mouse) {\n        this.parent = parent;\n        this.node = node;\n        this.anchorAngle = 0;\n        this.mouseOffsetAngle = 0;\n        this.text = '';\n\n        if(mouse) {\n            this.setAnchorPoint(mouse.x, mouse.y);\n        }\n    }\n\n    SelfLink.prototype.setMouseStart = function(x, y) {\n        this.mouseOffsetAngle = this.anchorAngle - Math.atan2(y - this.node.y, x - this.node.x);\n    };\n\n    SelfLink.prototype.setAnchorPoint = function(x, y) {\n        this.anchorAngle = Math.atan2(y - this.node.y, x - this.node.x) + this.mouseOffsetAngle;\n        // Snap to 90 degrees.\n        var snap = Math.round(this.anchorAngle / (Math.PI / 2)) * (Math.PI / 2);\n        if(Math.abs(this.anchorAngle - snap) < 0.1) {\n            this.anchorAngle = snap;\n        }\n        // Keep in the range -pi to pi so our containsPoint() function always works.\n        if(this.anchorAngle < -Math.PI) {\n            this.anchorAngle += 2 * Math.PI;\n        }\n        if(this.anchorAngle > Math.PI) {\n            this.anchorAngle -= 2 * Math.PI;\n        }\n    };\n\n    SelfLink.prototype.getEndPointsAndCircle = function() {\n        var circleX = this.node.x + 1.5 * this.parent.nodeRadius() * Math.cos(this.anchorAngle);\n        var circleY = this.node.y + 1.5 * this.parent.nodeRadius() * Math.sin(this.anchorAngle);\n        var circleRadius = 0.75 * this.parent.nodeRadius();\n        var startAngle = this.anchorAngle - Math.PI * 0.8;\n        var endAngle = this.anchorAngle + Math.PI * 0.8;\n        var startX = circleX + circleRadius * Math.cos(startAngle);\n        var startY = circleY + circleRadius * Math.sin(startAngle);\n        var endX = circleX + circleRadius * Math.cos(endAngle);\n        var endY = circleY + circleRadius * Math.sin(endAngle);\n        return {\n            'hasCircle': true,\n            'startX': startX,\n            'startY': startY,\n            'endX': endX,\n            'endY': endY,\n            'startAngle': startAngle,\n            'endAngle': endAngle,\n            'circleX': circleX,\n            'circleY': circleY,\n            'circleRadius': circleRadius\n        };\n    };\n\n    SelfLink.prototype.draw = function(c) {\n        var linkInfo = this.getEndPointsAndCircle();\n        // Draw arc.\n        c.beginPath();\n        c.arc(linkInfo.circleX, linkInfo.circleY, linkInfo.circleRadius, linkInfo.startAngle, linkInfo.endAngle, false);\n        c.stroke();\n        // Draw the text on the loop farthest from the node.\n        var textX = linkInfo.circleX + linkInfo.circleRadius * Math.cos(this.anchorAngle);\n        var textY = linkInfo.circleY + linkInfo.circleRadius * Math.sin(this.anchorAngle);\n        this.parent.drawText(this.text, textX, textY, this.anchorAngle, this);\n        // Draw the head of the arrow.\n        this.parent.arrowIfReqd(c, linkInfo.endX, linkInfo.endY, linkInfo.endAngle + Math.PI * 0.4);\n    };\n\n    SelfLink.prototype.containsPoint = function(x, y) {\n        var linkInfo = this.getEndPointsAndCircle();\n        var dx = x - linkInfo.circleX;\n        var dy = y - linkInfo.circleY;\n        var distance = Math.sqrt(dx * dx + dy * dy) - linkInfo.circleRadius;\n        return (Math.abs(distance) < this.parent.HIT_TARGET_PADDING);\n    };\n\n    /***********************************************************************\n     *\n     * Define a class StartLink that represents a start link in a finite\n     * state machine. Not useful in general digraphs.\n     *\n     ***********************************************************************/\n    function StartLink(parent, node, start) {\n        this.parent = parent;\n        this.node = node;\n        this.deltaX = 0;\n        this.deltaY = 0;\n\n        if(start) {\n            this.setAnchorPoint(start.x, start.y);\n        }\n    }\n\n    StartLink.prototype.setAnchorPoint = function(x, y) {\n        this.deltaX = x - this.node.x;\n        this.deltaY = y - this.node.y;\n\n        if(Math.abs(this.deltaX) < this.parent.SNAP_TO_PADDING) {\n            this.deltaX = 0;\n        }\n\n        if(Math.abs(this.deltaY) < this.parent.SNAP_TO_PADDING) {\n            this.deltaY = 0;\n        }\n    };\n\n    StartLink.prototype.getEndPoints = function() {\n        var startX = this.node.x + this.deltaX;\n        var startY = this.node.y + this.deltaY;\n        var end = this.node.closestPointOnCircle(startX, startY);\n        return {\n            'startX': startX,\n            'startY': startY,\n            'endX': end.x,\n            'endY': end.y,\n        };\n    };\n\n    StartLink.prototype.draw = function(c) {\n        var endPoints = this.getEndPoints();\n\n        // Draw the line.\n        c.beginPath();\n        c.moveTo(endPoints.startX, endPoints.startY);\n        c.lineTo(endPoints.endX, endPoints.endY);\n        c.stroke();\n\n        // Draw the head of the arrow.\n        this.parent.arrowIfReqd(c, endPoints.endX, endPoints.endY, Math.atan2(-this.deltaY, -this.deltaX));\n    };\n\n    StartLink.prototype.containsPoint = function(x, y) {\n        var endPoints = this.getEndPoints();\n        var dx = endPoints.endX - endPoints.startX;\n        var dy = endPoints.endY - endPoints.startY;\n        var length = Math.sqrt(dx * dx + dy * dy);\n        var percent = (dx * (x - endPoints.startX) + dy * (y - endPoints.startY)) / (length * length);\n        var distance = (dx * (y - endPoints.startY) - dy * (x - endPoints.startX)) / length;\n        return (percent > 0 && percent < 1 && Math.abs(distance) < this.parent.HIT_TARGET_PADDING);\n    };\n\n    /***********************************************************************\n     *\n     * Define a class TemporaryLink that represents a link that's in the\n     * process of being created.\n     *\n     ***********************************************************************/\n\n    function TemporaryLink(parent, from, to) {\n        this.parent = parent;\n        this.from = from;\n        this.to = to;\n    }\n\n    TemporaryLink.prototype.draw = function(c) {\n        // Draw the line.\n        c.beginPath();\n        c.moveTo(this.to.x, this.to.y);\n        c.lineTo(this.from.x, this.from.y);\n        c.stroke();\n\n        // Draw the head of the arrow.\n        this.parent.arrowIfReqd(c, this.to.x, this.to.y, Math.atan2(this.to.y - this.from.y, this.to.x - this.from.x));\n    };\n\n    /***********************************************************************\n     *\n     * Define a class Button as a base class from which more specific\n     * buttons can be derived.\n     *\n     ***********************************************************************/\n\n    function Button(toolbar, parent, w, h, iconClass, title) {\n        this.toolbar = toolbar;\n        this.parent = parent;\n        this.width = w; //In px.\n        this.height = h; //In px.\n        this.icon = iconClass;\n        this.title = title;\n    }\n\n    // The create function should be called explicitly in order to create the HTML element(s) of the button\n    Button.prototype.create = function () {\n        // Create the button, and add an unclickable icon\n        this.id = 'button_' + this.title.split(' ').join('_');\n\n        let toolbarContainerHeight = $(this.parent[0]).height();\n        let $button = $('<button/>')\n            .attr({\n                \"id\":       this.id,\n                \"class\":    'toolbar_button',\n                \"type\":     \"button\",\n                \"title\":    this.title,\n                \"style\":    \"width: \" + this.width + \"px; height: \" + this.height + \"px; margin-top: \" +\n                    (toolbarContainerHeight - this.height)/2 + \"px;\",\n            })\n            .append($('<i/>')\n            .addClass('icon fa ' + this.icon).attr({\n                    \"style\":    \"pointer-events: none\",\n                }));\n        $(this.parent[0]).append($button);\n        this.button = $button;\n    };\n\n    Button.prototype.onClick = function() {\n    };\n\n    /***********************************************************************\n     *\n     * Define a class ModeButton for the buttons used to switch modes,\n     * which are based on the general Button class\n     *\n     ***********************************************************************/\n\n    function ModeButton(toolbar, parent, w, h, iconClass, title, buttonModeType) {\n        Button.call(this, toolbar, parent, w, h, iconClass, title);\n        this.buttonModeType = buttonModeType; // Denotes which UI mode pressing the button activates\n    }\n\n    ModeButton.prototype = Object.create(Button.prototype);\n    ModeButton.prototype.constructor = ModeButton;\n\n    ModeButton.prototype.create = function() {\n        Button.prototype.create.call(this);\n\n        // Add 'mode' to the class\n        this.button.addClass('mode');\n\n        // Add the not_clicked class name by default, based on the button type\n        this.button.addClass('not_clicked');\n    };\n\n    ModeButton.prototype.onClick = function() {\n        Button.prototype.onClick();\n        this.setSelected();\n    };\n\n    ModeButton.prototype.setSelected = function() {\n        this.button.addClass('clicked');\n        this.button.removeClass('not_clicked');\n\n        // Set the mode of the UI\n        this.toolbar.onModeButtonPressed(this);\n    };\n\n    ModeButton.prototype.setDeselected = function() {\n        this.button.removeClass('clicked');\n        this.button.addClass('not_clicked');\n    };\n\n    /***********************************************************************\n     *\n     * Define a class HelpButton for the help button, which is based on\n     * the general Button class\n     *\n     ***********************************************************************/\n\n    function HelpButton(toolbar, parent, w, h, iconClass, title) {\n        Button.call(this, toolbar, parent, w, h, iconClass, title);\n    }\n\n    HelpButton.prototype = Object.create(Button.prototype);\n    HelpButton.prototype.constructor = HelpButton;\n\n    HelpButton.prototype.onClick = function() {\n        Button.prototype.onClick();\n\n        this.toolbar.displayHelpOverlay();\n    };\n\n    /***********************************************************************\n     *\n     * Define a class Checkbox which can be used in the graph toolbar\n     *\n     ***********************************************************************/\n\n    function Checkbox(toolbar, parent, type, text, eventFunction) {\n        this.toolbar = toolbar;\n        this.parent = parent;\n        this.text = text;\n        this.type = type;\n        this.eventFunction = eventFunction;\n    }\n\n    // The create function should be called explicitly in order to create the HTML element(s) of the checkbox\n    Checkbox.prototype.create = function () {\n        this.id = 'checkbox_' + this.text.split(' ').join('_');\n        let TOP_DISPLACEMENT = -3; // TODO: Don't know why the label is 3px from the top without any styling, needs fix\n        let HALF_CHECKBOX_HEIGHT = 8; // TODO: needs fix as well\n        let $checkbox = $('<label/>')\n            .attr({\n                'class':    'checkbox_label',\n            }).append($('<input/>')\n            .attr({\n                'id':       this.id,\n                'class':    'toolbar_checkbox',\n                'type':     'checkbox',\n            })).append(this.text);\n        $(this.parent[0]).append($checkbox);\n\n        // Add the event listener\n        $checkbox[0].addEventListener('change', (event) => this.handleInteraction(event));\n        this.object = $checkbox;\n    };\n\n    Checkbox.prototype.handleInteraction = function(event) {\n        this.eventFunction(event);\n    }\n\n    /***********************************************************************\n     *\n     * Define a class TextField which can be used in the graph toolbar\n     *\n     ***********************************************************************/\n\n    function TextField(toolbar, parent, w, placeholderText, eventFunction) {\n        this.toolbar = toolbar;\n        this.parent = parent;\n        this.w = w;\n        this.placeholderText = placeholderText;\n        this.eventFunction = eventFunction;\n    //<input type=\"text\" id=\"pin\" name=\"pin\" maxlength=\"4\" size=\"4\" placeholder=\"Hello0000008808080\">\n    }\n\n    // The create function should be called explicitly in order to create the HTML element(s) of the text field\n    TextField.prototype.create = function () {\n        this.id = 'textfield_' + this.placeholderText.split(' ').join('_');\n        let TOP_DISPLACEMENT = -3; // TODO: Don't know why the label is 3px from the top without any styling, needs fix\n        let HALF_CHECKBOX_HEIGHT = 8; // TODO: needs fix as well\n        let $textfield = $('<label/>')\n            .attr({\n                'class':    'textfield_label',\n            }).append(this.placeholderText + \":\")\n            .append($('<input/>')\n                .attr({\n                    'id':           this.id,\n                    'class':        'toolbar_textfield',\n                    'type':         'text',\n                    'placeholder':  this.placeholderText,\n                    'size':         this.w,\n                }));\n        $(this.parent[0]).append($textfield);\n\n        // Add the event listener\n        $textfield[0].addEventListener('change', (event) => this.handleInteraction(event));\n        this.object = $textfield;\n    };\n\n    TextField.prototype.handleInteraction = function(event) {\n        this.eventFunction(event);\n    }\n\n    return {\n        PetriNodeType: PetriNodeType,\n        ModeType: ModeType,\n        CheckboxType: CheckboxType,\n        Node: Node,\n        Link: Link,\n        SelfLink: SelfLink,\n        TemporaryLink: TemporaryLink,\n        StartLink: StartLink,\n        ModeButton: ModeButton,\n        HelpButton: HelpButton,\n        Checkbox: Checkbox,\n        TextField: TextField,\n    };\n});\n"],"file":"graphelements.min.js"}