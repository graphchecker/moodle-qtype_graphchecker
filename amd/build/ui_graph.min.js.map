{"version":3,"sources":["../src/ui_graph.js"],"names":["define","$","util","elements","GraphCanvas","parent","canvasId","w","h","HANDLE_SIZE","canvas","document","createElement","attr","id","class","tabindex","css","on","e","mousedown","mouseup","dblclick","keydown","mousemove","keypress","resize","Graph","textareaId","width","height","templateParams","save_this","SNAP_TO_PADDING","DUPLICATE_LINK_OFFSET","HIT_TARGET_PADDING","DEFAULT_NODE_RADIUS","DEFAULT_FONT_SIZE","textArea","getElementById","helpText","readOnly","prop","graphCanvas","caretVisible","caretTimer","originalClick","nodes","links","helpBox","HelpBox","helpBoxHighlighted","selectedObject","currentLink","movingObject","fail","failString","helpmenutext","require","str","helpPresent","get_string","when","done","graphhelp","reload","draw","prototype","failed","failMessage","getElement","getCanvas","hasFocus","activeElement","nodeRadius","noderadius","fontSize","fontsize","isFsm","isfsm","arrowIfReqd","c","x","y","angle","isdirected","drawArrow","sync","key","crossBrowserKey","metaKey","altKey","ctrlKey","text","String","fromCharCode","resetCaret","mouse","crossBrowserRelativeMousePos","selectObject","movingGraph","shiftKey","Node","SelfLink","movingNodes","traverseGraph","i","length","setMouseStart","locknodes","lockedges","Link","TemporaryLink","substr","splice","node","nodeA","nodeB","push","isAcceptState","closestPoint","mouseInHelpBox","containsPoint","targetNode","StartLink","closestPointOnCircle","trackMouse","snapNode","setAnchorPoint","addLink","Math","abs","newLink","maxPerpRHS","link","perpendicularPart","content","val","backup","JSON","parse","backupNode","backupNodeLayout","nodeGeometry","toString","edges","backupLink","backupLinkLayout","edgeGeometry","anchorAngle","deltaX","deltaY","parallelPart","lineAngleAdjust","save","trim","nodeData","nodeLayout","linkData","linkLayout","indexOf","stringify","destroy","clearInterval","off","remove","t","setInterval","getContext","clearRect","translate","lineWidth","fillStyle","strokeStyle","restore","drawText","originalText","angleOrNull","theObject","convertLatexShortcuts","dy","font","measureText","cos","sin","cornerPointX","cornerPointY","slide","pow","advancedFillText","round","fillText","beginPath","moveTo","lineTo","stroke","Constructor"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Much of this code is from Finite State Machine Designer:\n/*\n Finite State Machine Designer (http://madebyevan.com/fsm/)\n License: MIT License (see below)\n Copyright (c) 2010 Evan Wallace\n Permission is hereby granted, free of charge, to any person\n obtaining a copy of this software and associated documentation\n files (the \"Software\"), to deal in the Software without\n restriction, including without limitation the rights to use,\n copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the\n Software is furnished to do so, subject to the following\n conditions:\n The above copyright notice and this permission notice shall be\n included in all copies or substantial portions of the Software.\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\n OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\n WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\n FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n OTHER DEALINGS IN THE SOFTWARE.\n*/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more util.details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript to interfdigraph2 to the Graph editor, which is used both in\n * the author editing page and by the student question submission page.\n *\n * @package    qtype\n * @subpackage graphchecker\n * @copyright  Richard Lobb, 2015, The University of Canterbury\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n\n\ndefine(['jquery', 'qtype_graphchecker/graphutil', 'qtype_graphchecker/graphelements'], function($, util, elements) {\n\n    /***********************************************************************\n     *\n     * A GraphCanvas is a wrapper for a Graph's HTML canvas\n     * object.\n     *\n     ************************************************************************/\n\n    function GraphCanvas(parent, canvasId, w, h) {\n        // Constructor, given the Graph that owns this canvas, the\n        // required canvasId and the height and width of the wrapper that\n        // encloses the Canvas.\n\n        this.HANDLE_SIZE = 10;\n\n        this.parent = parent;\n        this.canvas = $(document.createElement(\"canvas\"));\n        this.canvas.attr({\n            id:         canvasId,\n            class:      \"graphchecker_graphcanvas\",\n            tabindex:   1 // So canvas can get focus.\n        });\n        this.canvas.css({'background-color': 'white'});\n\n        this.canvas.on('mousedown', function(e) {\n            return parent.mousedown(e);\n        });\n\n        this.canvas.on('mouseup', function(e) {\n            return parent.mouseup(e);\n        });\n\n        this.canvas.on('dblclick', function(e) {\n            return parent.dblclick(e);\n        });\n\n        this.canvas.on('keydown', function(e) {\n            return parent.keydown(e);\n        });\n\n        this.canvas.on('mousemove', function(e) {\n            return parent.mousemove(e);\n        });\n\n        this.canvas.on('keypress', function(e) {\n            return parent.keypress(e);\n        });\n\n        this.resize = function(w, h) {\n            // Resize to given dimensions.\n            this.canvas.attr(\"width\", w);\n            this.canvas.attr(\"height\", h);\n        };\n\n        this.resize(w, h);\n    }\n\n    /***********************************************************************\n     *\n     *  This is the ui component for a graph-drawing graphchecker question.\n     *\n     ***********************************************************************/\n\n    function Graph(textareaId, width, height, templateParams) {\n        // Constructor.\n        var save_this = this;\n\n        this.SNAP_TO_PADDING = 6;\n        this.DUPLICATE_LINK_OFFSET = 16; // Pixels offset for a duplicate link\n        this.HIT_TARGET_PADDING = 6;    // Pixels.\n        this.DEFAULT_NODE_RADIUS = 26;  // Pixels. Template parameter noderadius can override this.\n        this.DEFAULT_FONT_SIZE = 20;    // px. Template parameter fontsize can override this.\n\n        this.canvasId = 'graphcanvas_' + textareaId;\n        this.textArea = $(document.getElementById(textareaId));\n        this.helpText = ''; // Obtained by JSON - see below.\n        this.readOnly = this.textArea.prop('readonly');\n        this.templateParams = templateParams;\n        this.graphCanvas = new GraphCanvas(this,  this.canvasId, width, height);\n        this.caretVisible = true;\n        this.caretTimer = 0;  // Need global so we can kill a running timer.\n        this.originalClick = null;\n        this.nodes = [];\n        this.links = [];\n        this.helpBox = new elements.HelpBox(this, 0, 0);\n        this.helpBoxHighlighted = false;\n        this.selectedObject = null; // Either a elements.Link or a elements.Node.\n        this.currentLink = null;\n        this.movingObject = false;\n        this.fail = false;  // Will be set true if reload fails (can't deserialise).\n        this.failString = null;  // Language string key for fail error message.\n        if ('helpmenutext' in templateParams) {\n            this.helpText = templateParams.helpmenutext;\n        } else {\n            require(['core/str'], function(str) {\n                // Get help text via AJAX.\n                var helpPresent = str.get_string('graphhelp', 'qtype_graphchecker');\n                $.when(helpPresent).done(function(graphhelp) {\n                    save_this.helpText = graphhelp;\n                });\n            });\n        }\n        this.reload();\n        if (!this.fail) {\n            this.draw();\n        }\n    }\n\n    Graph.prototype.failed = function() {\n        return this.fail;\n    };\n\n    Graph.prototype.failMessage = function() {\n        return this.failString;\n    };\n\n    Graph.prototype.getElement = function() {\n        return this.getCanvas();\n    };\n\n    Graph.prototype.hasFocus = function() {\n        return document.activeElement == this.getCanvas();\n    };\n\n    Graph.prototype.getCanvas = function() {\n        var canvas = this.graphCanvas.canvas[0];\n        return canvas;\n    };\n\n    Graph.prototype.nodeRadius = function() {\n        return this.templateParams.noderadius ? this.templateParams.noderadius : this.DEFAULT_NODE_RADIUS;\n    };\n\n    Graph.prototype.fontSize = function() {\n        return this.templateParams.fontsize ? this.templateParams.fontsize : this.DEFAULT_FONT_SIZE;\n    };\n\n    Graph.prototype.isFsm = function() {\n        return this.templateParams.isfsm !== undefined ? this.templateParams.isfsm : true;\n    };\n\n    // Draw an arrow head if this is a directed graph. Otherwise do nothing.\n    Graph.prototype.arrowIfReqd = function(c, x, y, angle) {\n        if (this.templateParams.isdirected === undefined || this.templateParams.isdirected) {\n            util.drawArrow(c, x, y, angle);\n        }\n    };\n\n    // Copy the serialised version of the graph to the TextArea.\n    Graph.prototype.sync = function() {\n        // Nothing to do ... always sync'd.\n    };\n\n    Graph.prototype.keypress = function(e) {\n        var key = util.crossBrowserKey(e);\n\n        if (this.readOnly) {\n            return;\n        }\n\n        if(key >= 0x20 &&\n                  key <= 0x7E &&\n                  !e.metaKey &&\n                  !e.altKey &&\n                  !e.ctrlKey &&\n                  this.selectedObject !== null &&\n                  'text' in this.selectedObject) {\n\n            this.selectedObject.text += String.fromCharCode(key);\n            this.resetCaret();\n            this.draw();\n\n            // Don't let keys do their actions (like space scrolls down the page).\n            return false;\n        } else if(key === 8 || key === 0x20 || key === 9) {\n            // Disable scrolling on backspace, tab and space.\n            return false;\n        }\n    };\n\n    Graph.prototype.mousedown = function(e) {\n        var mouse = util.crossBrowserRelativeMousePos(e);\n\n        if (this.readOnly) {\n            return;\n        }\n\n        this.selectedObject = this.selectObject(mouse.x, mouse.y);\n        this.movingObject = false;\n        this.movingGraph = false;\n        this.originalClick = mouse;\n\n        if(this.selectedObject !== null) {\n            if(e.shiftKey && this.selectedObject instanceof elements.Node) {\n                this.currentLink = new elements.SelfLink(this, this.selectedObject, mouse);\n            } else if (e.altKey && this.selectedObject instanceof elements.Node) {\n                // Moving an entire connected graph component.\n                this.movingGraph = true;\n                this.movingNodes = this.selectedObject.traverseGraph(this.links, []);\n                for (var i = 0; i < this.movingNodes.length; i++) {\n                    this.movingNodes[i].setMouseStart(mouse.x, mouse.y);\n                }\n            } else if (!(this.templateParams.locknodes && this.selectedObject instanceof elements.Node)\n                       && !(this.templateParams.lockedges && this.selectedObject instanceof elements.Link)){\n                this.movingObject = true;\n                if(this.selectedObject.setMouseStart) {\n                    this.selectedObject.setMouseStart(mouse.x, mouse.y);\n                }\n            }\n            this.resetCaret();\n        } else if(e.shiftKey && this.isFsm()) {\n            this.currentLink = new elements.TemporaryLink(this, mouse, mouse);\n        }\n\n        this.draw();\n\n        if(this.hasFocus()) {\n            // Disable drag-and-drop only if the canvas is already focused.\n            return false;\n        } else {\n            // Otherwise, let the browser switch the focus away from wherever it was.\n            this.resetCaret();\n            return true;\n        }\n    };\n\n    Graph.prototype.keydown = function(e) {\n        var key = util.crossBrowserKey(e), i;\n\n        if (this.readOnly) {\n            return;\n        }\n\n        if(key === 8) { // Backspace key.\n            if(this.selectedObject !== null && 'text' in this.selectedObject) {\n                this.selectedObject.text = this.selectedObject.text.substr(0, this.selectedObject.text.length - 1);\n                this.resetCaret();\n                this.draw();\n            }\n\n            // Backspace is a shortcut for the back button, but do NOT want to change pages.\n            return false;\n        } else if(key === 46) { // Delete key.\n            if(this.selectedObject !== null) {\n                for(i = 0; i < this.nodes.length; i++) {\n                    if(this.nodes[i] === this.selectedObject) {\n                        this.nodes.splice(i--, 1);\n                    }\n                }\n                for(i = 0; i < this.links.length; i++) {\n                    if(this.links[i] === this.selectedObject ||\n                           this.links[i].node === this.selectedObject ||\n                           this.links[i].nodeA === this.selectedObject ||\n                           this.links[i].nodeB === this.selectedObject) {\n                        this.links.splice(i--, 1);\n                    }\n                }\n                this.selectedObject = null;\n                this.draw();\n            }\n        } else if(key === 13) { // Enter key.\n            if(this.selectedObject !== null) {\n                // Deselect the object.\n                this.selectedObject = null;\n                this.draw();\n            }\n        }\n    };\n\n    Graph.prototype.dblclick = function(e) {\n        var mouse = util.crossBrowserRelativeMousePos(e);\n\n        if (this.readOnly) {\n            return;\n        }\n\n        this.selectedObject = this.selectObject(mouse.x, mouse.y);\n\n        if(this.selectedObject === null) {\n            this.selectedObject = new elements.Node(this, mouse.x, mouse.y);\n            this.nodes.push(this.selectedObject);\n            this.resetCaret();\n            this.draw();\n        } else {\n            if(this.selectedObject instanceof elements.Node && this.isFsm()) {\n                this.selectedObject.isAcceptState = !this.selectedObject.isAcceptState;\n                this.draw();\n            }\n        }\n    };\n\n    Graph.prototype.resize = function(w, h) {\n        this.graphCanvas.resize(w, h);\n        this.draw();\n    };\n\n    Graph.prototype.mousemove = function(e) {\n        var mouse = util.crossBrowserRelativeMousePos(e),\n            closestPoint,\n            mouseInHelpBox = this.helpBox.containsPoint(mouse.x, mouse.y);\n\n        if (this.readOnly) {\n            return;\n        }\n\n        if (mouseInHelpBox != this.helpBoxHighlighted) {\n            this.helpBoxHighlighted = mouseInHelpBox;\n            this.draw();\n        }\n\n        if(this.currentLink !== null) {\n            var targetNode = this.selectObject(mouse.x, mouse.y);\n            if(!(targetNode instanceof elements.Node)) {\n                targetNode = null;\n            }\n\n            if(this.selectedObject === null) {\n                if(targetNode !== null) {\n                    this.currentLink = new elements.StartLink(this, targetNode, this.originalClick);\n                } else {\n                    this.currentLink = new elements.TemporaryLink(this, this.originalClick, mouse);\n                }\n            } else {\n                if(targetNode === this.selectedObject) {\n                    this.currentLink = new elements.SelfLink(this, this.selectedObject, mouse);\n                } else if(targetNode !== null) {\n                    this.currentLink = new elements.Link(this, this.selectedObject, targetNode);\n                } else {\n                    closestPoint = this.selectedObject.closestPointOnCircle(mouse.x, mouse.y);\n                    this.currentLink = new elements.TemporaryLink(this, closestPoint, mouse);\n                }\n            }\n            this.draw();\n        }\n        if (this.movingGraph) {\n            var nodes = this.movingNodes;\n            for (var i = 0; i < nodes.length; i++) {\n                 nodes[i].trackMouse(mouse.x, mouse.y);\n                 this.snapNode(nodes[i]);\n            }\n            this.draw();\n        } else if(this.movingObject) {\n            this.selectedObject.setAnchorPoint(mouse.x, mouse.y);\n            if(this.selectedObject instanceof elements.Node) {\n                this.snapNode(this.selectedObject);\n            }\n            this.draw();\n        }\n    };\n\n    Graph.prototype.mouseup = function() {\n\n        if (this.readOnly) {\n            return;\n        }\n\n        this.movingObject = false;\n        this.movingGraph = false;\n\n        if(this.currentLink !== null) {\n            if(!(this.currentLink instanceof elements.TemporaryLink)) {\n                this.selectedObject = this.currentLink;\n                this.addLink(this.currentLink);\n                this.resetCaret();\n            }\n            this.currentLink = null;\n            this.draw();\n        }\n    };\n\n    Graph.prototype.selectObject = function(x, y) {\n        var i;\n        if (this.helpBox.containsPoint(x, y) && this.selectedObject != this.helpBox) {\n            // Clicking the help box menu item toggles its select state.\n            return this.helpBox;\n        }\n\n        for(i = 0; i < this.nodes.length; i++) {\n            if(this.nodes[i].containsPoint(x, y)) {\n                return this.nodes[i];\n            }\n        }\n        for(i = 0; i < this.links.length; i++) {\n            if(this.links[i].containsPoint(x, y)) {\n                return this.links[i];\n            }\n        }\n        return null;\n    };\n\n    Graph.prototype.snapNode = function(node) {\n        for(var i = 0; i < this.nodes.length; i++) {\n            if(this.nodes[i] === node){\n                continue;\n            }\n\n            if(Math.abs(node.x - this.nodes[i].x) < this.SNAP_TO_PADDING) {\n                node.x = this.nodes[i].x;\n            }\n\n            if(Math.abs(node.y - this.nodes[i].y) < this.SNAP_TO_PADDING) {\n                node.y = this.nodes[i].y;\n            }\n        }\n    };\n\n    // Add a new link (always 'this.currentLink') to the set of links.\n    // If the link connects two nodes already linked, the angle of the new link\n    // is tweaked so it is distinguishable from the existing links.\n    Graph.prototype.addLink = function(newLink) {\n        var maxPerpRHS = null;\n        for (var i = 0; i < this.links.length; i++) {\n            var link = this.links[i];\n            if (link.nodeA === newLink.nodeA && link.nodeB === newLink.nodeB) {\n                if (maxPerpRHS === null || link.perpendicularPart > maxPerpRHS) {\n                    maxPerpRHS = link.perpendicularPart;\n                }\n            }\n            if (link.nodeA === newLink.nodeB && link.nodeB === newLink.nodeA) {\n                if (maxPerpRHS === null || -link.perpendicularPart > maxPerpRHS ) {\n                    maxPerpRHS = -link.perpendicularPart;\n                }\n            }\n        }\n        if (maxPerpRHS !== null) {\n            newLink.perpendicularPart = maxPerpRHS + this.DUPLICATE_LINK_OFFSET;\n        }\n        this.links.push(newLink);\n    };\n\n    Graph.prototype.reload = function() {\n        var content = $(this.textArea).val();\n        if (content) {\n            try {\n                // Load up the student's previous answer if non-empty.\n                var backup = JSON.parse(content), i;\n\n                for(i = 0; i < backup.nodes.length; i++) {\n                    var backupNode = backup.nodes[i];\n                    var backupNodeLayout = backup.nodeGeometry[i];\n                    var node = new elements.Node(this, backupNodeLayout[0], backupNodeLayout[1]);\n                    node.isAcceptState = backupNode[1];\n                    node.text = backupNode[0].toString();\n                    this.nodes.push(node);\n                }\n\n                for(i = 0; i < backup.edges.length; i++) {\n                    var backupLink = backup.edges[i];\n                    var backupLinkLayout = backup.edgeGeometry[i];\n                    var link = null;\n                    if(backupLink[0] === backupLink[1]) {\n                        // Self link has two identical nodes.\n                        link = new elements.SelfLink(this, this.nodes[backupLink[0]]);\n                        link.anchorAngle = backupLinkLayout.anchorAngle;\n                        link.text = backupLink[2].toString();\n                    } else if(backupLink[0] === -1) {\n                        link = new elements.StartLink(this, this.nodes[backupLink[1]]);\n                        link.deltaX = backupLinkLayout.deltaX;\n                        link.deltaY = backupLinkLayout.deltaY;\n                    } else {\n                        link = new elements.Link(this, this.nodes[backupLink[0]], this.nodes[backupLink[1]]);\n                        link.parallelPart = backupLinkLayout.parallelPart;\n                        link.perpendicularPart = backupLinkLayout.perpendicularPart;\n                        link.text = backupLink[2].toString();\n                        link.lineAngleAdjust = backupLinkLayout.lineAngleAdjust;\n                    }\n                    if(link !== null) {\n                        this.links.push(link);\n                    }\n                }\n            } catch(e) {\n                this.fail = true;\n                this.failString = 'graph_ui_invalidserialisation';\n            }\n        }\n    };\n\n    Graph.prototype.save = function() {\n\n        var backup = {\n            'edgeGeometry': [],\n            'nodeGeometry': [],\n            'nodes': [],\n            'edges': [],\n        };\n        var i;\n\n        if(!JSON || (this.textArea.val().trim() === '' && this.nodes.length === 0)) {\n            return;  // Don't save if we have an empty textbox and no graphic content.\n        }\n\n        for(i = 0; i < this.nodes.length; i++) {\n            var node = this.nodes[i];\n\n            var nodeData = [node.text, node.isAcceptState];\n            var nodeLayout = [node.x, node.y];\n\n            backup.nodeGeometry.push(nodeLayout);\n            backup.nodes.push(nodeData);\n        }\n\n        for(i = 0; i < this.links.length; i++) {\n            var link = this.links[i],\n                linkData = null,\n                linkLayout = null;\n\n            if(link instanceof elements.SelfLink) {\n                linkLayout = {\n                    'anchorAngle': link.anchorAngle,\n                };\n                linkData = [this.nodes.indexOf(link.node), this.nodes.indexOf(link.node), link.text];\n            } else if(link instanceof elements.StartLink) {\n                linkLayout = {\n                    'deltaX': link.deltaX,\n                    'deltaY': link.deltaY\n                };\n                linkData = [-1, this.nodes.indexOf(link.node), \"\"];\n            } else if(link instanceof elements.Link) {\n                linkLayout = {\n                    'lineAngleAdjust': link.lineAngleAdjust,\n                    'parallelPart': link.parallelPart,\n                    'perpendicularPart': link.perpendicularPart,\n                };\n                linkData = [this.nodes.indexOf(link.nodeA), this.nodes.indexOf(link.nodeB), link.text];\n            }\n            if(linkData !== null && linkLayout !== null) {\n                backup.edges.push(linkData);\n                backup.edgeGeometry.push(linkLayout);\n            }\n        }\n        this.textArea.val(JSON.stringify(backup));\n    };\n\n    Graph.prototype.destroy = function () {\n        clearInterval(this.caretTimer); // Stop the caret timer.\n        this.graphCanvas.canvas.off();  // Stop all events.\n        this.graphCanvas.canvas.remove();\n\n    };\n\n    Graph.prototype.resetCaret = function () {\n        var t = this; // For embedded function to access this.\n\n        clearInterval(this.caretTimer);\n        this.caretTimer = setInterval(function() {\n            t.caretVisible = !t.caretVisible;\n            t.draw();\n        }, 500);\n        this.caretVisible = true;\n    };\n\n    Graph.prototype.draw = function () {\n        var canvas = this.getCanvas(),\n            c = canvas.getContext('2d'),\n            i;\n\n        c.clearRect(0, 0, this.getCanvas().width, this.getCanvas().height);\n        c.save();\n        c.translate(0.5, 0.5);\n\n        this.helpBox.draw(c, this.selectedObject == this.helpBox, this.helpBoxHighlighted);\n        if (this.selectedObject != this.helpBox) {  // Only proceed if help info not showing.\n\n            for(i = 0; i < this.nodes.length; i++) {\n                c.lineWidth = 1;\n                c.fillStyle = c.strokeStyle = (this.nodes[i] === this.selectedObject) ? 'blue' : 'black';\n                this.nodes[i].draw(c);\n            }\n            for(i = 0; i < this.links.length; i++) {\n                c.lineWidth = 1;\n                c.fillStyle = c.strokeStyle = (this.links[i] === this.selectedObject) ? 'blue' : 'black';\n                this.links[i].draw(c);\n            }\n            if(this.currentLink !== null) {\n                c.lineWidth = 1;\n                c.fillStyle = c.strokeStyle = 'black';\n                this.currentLink.draw(c);\n            }\n        }\n\n        c.restore();\n        this.save();\n    };\n\n    Graph.prototype.drawText = function(originalText, x, y, angleOrNull, theObject) {\n        var c = this.getCanvas().getContext('2d'),\n            text = util.convertLatexShortcuts(originalText),\n            width,\n            dy;\n\n        c.font = this.fontSize() + 'px Arial';\n        width = c.measureText(text).width;\n\n        // Center the text.\n        x -= width / 2;\n\n        // Position the text intelligently if given an angle.\n        if(angleOrNull !== null) {\n            var cos = Math.cos(angleOrNull);\n            var sin = Math.sin(angleOrNull);\n            var cornerPointX = (width / 2) * (cos > 0 ? 1 : -1);\n            var cornerPointY = 10 * (sin > 0 ? 1 : -1);\n            var slide = sin * Math.pow(Math.abs(sin), 40) * cornerPointX - cos * Math.pow(Math.abs(cos), 10) * cornerPointY;\n            x += cornerPointX - sin * slide;\n            y += cornerPointY + cos * slide;\n        }\n\n        // Draw text and caret (round the coordinates so the caret falls on a pixel).\n        if('advancedFillText' in c) {\n            c.advancedFillText(text, originalText, x + width / 2, y, angleOrNull);\n        } else {\n            x = Math.round(x);\n            y = Math.round(y);\n            dy = Math.round(this.fontSize() / 3); // Don't understand this.\n            c.fillText(text, x, y + dy);\n            if(theObject == this.selectedObject && this.caretVisible && this.hasFocus() && document.hasFocus()) {\n                x += width;\n                dy = Math.round(this.fontSize() / 2);\n                c.beginPath();\n                c.moveTo(x, y - dy);\n                c.lineTo(x, y + dy);\n                c.stroke();\n            }\n        }\n    };\n\n    return {\n        Constructor: Graph\n    };\n});\n"],"file":"ui_graph.min.js"}